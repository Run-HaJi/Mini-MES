# 🛠️ Mini-MES 开发日记 (2026-02-02)

> **记录者**: 核心开发组
> **状态**: 第一阶段里程碑完成 (Backend + Frontend + DB MVP)

## 🏆 今日战果 (Achievements)

### 1. 基础设施搭建 (Infrastructure)
- [x] **Docker 化部署**: 完成了 `docker-compose.yml` 编排，实现了 Backend (FastAPI) 和 Database (MySQL 8.0) 的一键拉起。
- [x] **数据持久化**: 解决了 MySQL 容器的数据卷挂载，保证重启后数据不丢失。
- [x] **开发环境隔离**: 确立了 "本地 venv (IDE 辅助) + 容器 Docker (实际运行)" 的开发模式。

### 2. 后端核心突破 (Backend)
- [x] **异步架构**: 采用 `SQLAlchemy` + `AsyncMy` 全异步驱动，为高并发打底。
- [x] **防御性设计**: 落地了 **"JSON 混合存储"** 策略（`payload` 字段），成功解决工业现场非结构化数据多变的需求，无需频繁变更 Schema。
- [x] **API 落地**: 完成了数据入库 (`POST /upload`) 和 列表查询 (`GET /list`) 接口，并经 Swagger UI 验证通过。

### 3. 前端可视化 (Frontend)
- [x] **工业风 UI**: 清理 Vue3 脚手架，引入 **Element Plus**，确立了“黑底高对比度”的硬核工业风格。
- [x] **前后端打通**: 配置 CORS 解决跨域问题，前端成功从后端拉取实时生产数据。
- [x] **实时看板**: 实现了自动刷新/手动刷新的表格展示，数据流全链路跑通。

---

## 💣 踩坑与填坑记录 (Troubleshooting)

### 1. 环境依赖之坑 (Windows vs Docker)
- **现象**: 本地 VS Code 爆黄线，安装 `requirements.txt` 里的 `asyncmy` 失败。
- **原因**: `asyncmy` 依赖 C 编译器，Windows 本地环境极其难装。
- **解法**: **环境解耦**。本地只装 `fastapi` 等基础包用于骗过 IDE 的静态检查，实际运行时全部交给 Docker 环境。

### 2. 网络长城之坑 (Network/GFW)
- **现象**: `docker-compose up` 报 `EOF` 错误，无法拉取 Python 镜像。
- **原因**: 国内网络环境导致连接 Docker Hub 超时。
- **解法**: 
    1. 配置 Docker Desktop 的 Proxy 设置（手动指定 HTTP/HTTPS 端口）。
    2. 或手动使用 `docker pull` 拉取基础镜像。

### 3. 低级失误之坑 (Human Errors)
- **现象**: 后端报错 `NameError: BaseModule not defined` 或 `No module named app.main`。
- **原因**: 
    1. 复制粘贴代码时漏掉了文件头部的 `import` 语句。
    2. VS Code 编辑后**未保存文件**，导致容器内读取的是旧文件。
- **解法**: 养成检查头部引用的习惯；遇到离奇报错先按 `Ctrl+S`。

### 4. 路径迷失之坑 (Directory Context)
- **现象**: 在 `src/backend` 子目录下运行 `docker-compose` 报错。
- **解法**: 牢记容器编排命令必须在 **项目根目录** (存在 `.yml` 的地方) 执行。

---

## 📝 下一步计划 (Next Steps)
1. **边缘采集端 (Client)**: 编写 Python 脚本模拟 PLC/电子秤数据，并打包为 `.exe`。
2. **真实业务完善**: 增加批次号、异常报警等字段。
3. **部署测试**: 在真实局域网环境下进行压力测试。