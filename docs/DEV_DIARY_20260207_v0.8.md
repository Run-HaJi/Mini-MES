# 🛠️ Mini-MES 开发日记 (2026-02-07)

> **记录者**: Run-Haji
> **状态**: v0.8 Workstation HMI (The "Human-in-the-Loop")
> **关键词**: Context Awareness, Industrial UX, Persistence, Source Tracking

## 🧩 核心思考：跨越“最后的一米” (The Last Mile)

### 1. 架构师的自我审视 (Reflections)
截止昨晚 v0.7 发布，我们打造了一个漂亮的“云端堡垒”：老板能看报表，管理员能管账号。系统看起来很完美。
但在对照 **《需求规格说明书 V1.1》** (SRS 4.3) 进行沙盘推演时，我们发现了一个致命的**逻辑真空**：

* **“悬浮”的系统**：我们的系统高高在上，却接不到地气。当 `PRESS-001` 产出一批次品时，数据冷冰冰地躺在数据库里，我们却无法回答**“当时是谁在操作机器？”**这个问题。
* **决策调整**：必须把重心下沉。从舒适的“办公室 Web 端”走出来，深入到嘈杂脏乱的“车间现场”。
* **v0.8 的定义**：这不是一个简单的“新页面”，而是 Mini-MES **边缘侧能力的觉醒**。我们要把“人”变成系统感知的一部分。

---

## 🏗️ 战术执行：打造抗脆弱的工位终端 (Execution)

### 1. 前端哲学：为“粗手指”设计 (Industrial UX)
车间不是写字楼，光线昏暗，工人戴着手套，没空在那精细对准鼠标。
* **暗黑模式 (Dark Mode)**：我们摒弃了 v0.7 的清爽白底，为 `StationView` 启用了高对比度的深色 UI。这不是为了酷，是为了在低光环境下不刺眼。
* **沉浸式路由 (Full Screen)**：在 `router/index.js` 中，我们刻意将 `/station` 提权为顶级路由，移除了侧边栏和顶栏。
    * *思考*：工位机就是专机专用的，任何多余的导航跳转都是对生产注意力的干扰。

### 2. 交互攻坚：对抗“无状态” (Fighting Statelessness)
* **挑战**: Web 是无状态的。但在工业现场，网络抖动是常态，误触 F5 刷新更是家常便饭。如果工人辛辛苦苦输完一半数据，手一抖页面刷新，登录态丢了，这简直是灾难。
* **对策**: 引入 **LocalStorage 持久化策略**。
    * 我们在内存 (`Vue Ref`) 和 硬盘 (`Browser Storage`) 之间建立了一道同步桥梁。
    * **结果**：无论怎么刷新，只要没有点击“下岗”，系统就牢牢锁死在当前操作员身上。这种**“粘性”**是工业软件稳定性的基石。

### 3. 后端逻辑：数据源的二元论 (Data Provenance)
为了响应 SRS 文档中对“数据清洗”的要求，我们在 `src/backend/app/api/station.py` 中确立了数据源的“阶级成分”：
* **AUTO**: 机器传的，客观但冰冷。
* **MANUAL**: 人工录的，主观但有温度。
    * *代码实现*：我们在写入日志时，强制关联了 `operator_id` 和 `operator_name`。从此，每一条数据都有了“归属权”。

---

## 🐛 踩坑实录 (The "Gotchas")

### Docker 的端口保卫战
* **现象**: `bind: address already in use`。
* **复盘**: 这是 Windows 开发环境下的典型冲突。本地自启的 MySQL 8.0 是个“钉子户”，死死占住 3306。
* **解决**: 我们没有暴力杀进程，而是优雅地修改 `docker-compose.yml`，将容器端口映射迁移至 `3307`。
    * *教训*：在容器化编排中，**端口隔离**是第一课。

---

## 🔭 未来推演：向“实时”进发 (Roadmap)

站在 v0.8 的肩膀上，Mini-MES 已经实现了数据的**全链路闭环**（采集 -> 补录 -> 存储 -> 追溯）。但我们还不够快。

* **v0.9 的目标**: **Real-time Awareness (实时感知)**。
* **技术预判 (Technical Preview)**: 
    * 有人建议上 Redis + WebSocket。
    * 但作为架构师，我依然坚持 **KISS 原则 (Keep It Simple, Stupid)**。
    * 在 v0.9 中，我们将探索 **“短轮询 (Short Polling) + 关联查询”** 的轻量化方案。在不引入新组件（降低运维成本）的前提下，让 Dashboard 的数据“跳动”起来。

