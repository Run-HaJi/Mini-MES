# 🛠️ Mini-MES 开发日记 (2026-02-03)

> **记录者**: Run-Haji
> **状态**: v0.2 Release (Edge Client Delivery)
> **关键词**: PyInstaller, Undersampling, Silent Refresh, DevOps

## 🏆 今日里程碑 (Milestones)

### 1. 边缘采集端交付 (Edge Client Delivery)
* **模拟器开发**: 编写了 `client/mock_device.py`，能够生成符合 SRS 规范的随机 JSON 数据（LineID, SKU, Weight, Temperature）。
* **二进制打包 (核心突破)**: 使用 `PyInstaller` 将 Python 脚本打包为单文件 `.exe`。
    * **意义**: 彻底解除了对现场工控机 Python 环境的依赖，实现了“U盘插拔式”部署。
    * **成果**: 生成 `MiniMES_Edge_Client.exe` (约 6-10MB)，双击即可运行。

### 2. 前端体验重构 (Frontend UX)
* **解决“欠采样”问题 (Undersampling)**:
    * *现象*: 之前看板每 5 秒刷新，设备每 3 秒生产，导致数据出现 "1-2-2" 的不均匀跳动。
    * *修复*: 调整采样频率，遵循 **奈奎斯特采样定理** 原则，将前端轮询间隔调整为 1~2 秒（快于生产速率），实现流畅的逐条上屏。
* **静默刷新策略 (Silent Refresh)**:
    * *现象*: 每次自动刷新都弹窗“成功”，造成视觉干扰。
    * *优化*: 改造 `fetchData` 逻辑，仅在**手动点击按钮**时显示 Toast 反馈，自动轮询时保持静默。

### 3. 工程化与版本控制 (Engineering)
* **Git 规范化**: 修正了 `.gitignore`，剔除 `dist/`, `build/`, `*.spec` 等编译产物，保持代码库纯净。
* **v0.2 版本发布**: 成功推送至 GitHub `main` 分支。

---

## 🔧 技术深钻 (Technical Deep Dive)

### 关于 Docker 代理 (Network/Proxy)
今天遭遇了严重的 Docker Hub 连接超时问题 (`EOF` / `Timeout`)。
* **反思**: 在国内进行云原生开发，**网络基建**是最大的不可控变量。
* **对策**: 以后在部署文档中，必须强调 Docker Desktop 的 Proxy 设置，或者提供离线镜像包 (Save/Load) 方案，不能假设客户现场网络畅通。

### 关于 PyInstaller 的路径陷阱
在 Windows 环境下直接运行 `pyinstaller` 报错，原因是 Script 目录未加入系统 PATH。
* **最佳实践**: 使用 `python -m PyInstaller` 代替直接调用。这能确保调用的是当前 Python 解释器关联的模块，避免环境混乱。

### 关于 Git 上下文
在子目录 (`src/client`) 执行 `git add .` 只会暂存当前目录文件，导致根目录的 `.gitignore` 修改未被提交。
* **教训**: 执行 Git 操作时，最好习惯性回到 **项目根目录** (`root`)，或者使用 `git add -A` 确保全量覆盖。

---

## 📝 待办清单 (Backlog)

虽然 v0.2 已达成，但业务功能仍有缺口，下一步 (v0.3) 重点攻克：

1.  **Excel 报表导出**: 满足管理层查看历史数据的需求（后端流式响应 + 前端下载）。
2.  **AES 真实解密**: 替换目前的模拟数据，对接真实的加密/解密逻辑（需引入 `pycryptodome` 库）。
3.  **异常处理**: 增加对后端服务宕机时的边缘端重试机制（目前仅有简单的 print 报错）。

---
