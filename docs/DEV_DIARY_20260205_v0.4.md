# 🛠️ Mini-MES 开发日记 (2026-02-05)

> **记录者**: Run-Haji
> **状态**: v0.4 Security Update (End-to-End Encryption)
> **关键词**: AES-256, PyCryptodome, End-to-End Encryption, Docker Network

## 🛡️ 里程碑：给系统穿上防弹衣 (The Armor)

### 1. 核心成就 (Achievements)
今天我们攻克了工业物联网中最敏感的“数据安全”难题，实现了从边缘端到服务端的**端到端加密 (E2EE)**。



* **边缘端进化 (Client v0.4)**:
    * 改造 `mock_device.py`，引入 `pycryptodome` 库。
    * 实现 **AES-256 (CBC模式)** 加密逻辑。
    * **效果**: 设备发出的不再是明文 JSON，而是经过 Base64 编码的高强度密文 (`BiGJMjOoe...`)，彻底杜绝了网络嗅探风险。

* **服务端升级 (Backend v0.4)**:
    * **Schema 变更**: 修改 Pydantic 模型，将 `payload` 字段类型从字典放宽为字符串，以接收密文。
    * **解密中间件**: 在数据入库前植入解密逻辑（Decrypt -> Unpad -> JSON Load），确保落库的数据是业务可读的明文。
    * **验证**: 实现了“传输层乱码，应用层明文”的完美闭环。

### 2. 工程化排坑 (Troubleshooting)
* **Docker 网络之殇**:
    * **问题**: 构建镜像时拉取 `pycryptodome` 失败，出现 `dial tcp [IPv6]...` 超时错误。
    * **分析**: Docker 默认网络策略与国内网络环境的兼容性问题（代理分流失效）。
    * **解决**: 调整代理模式为 Global（或切换国内镜像源），成功打通 Docker Hub 链路。
    * **反思**: 环境配置（Environment Configuration）往往比代码逻辑更消耗时间，标准化的 `Dockerfile` 和镜像源配置是团队协作的基石。

---

## 🧘‍♂️ 深度思考 (Insights)

### “可见”与“不可见”的辩证
今天的开发很有意思：
* 在 **Wireshark/网络层** 看来，我们的系统是**“不可见”**的（全是乱码）。
* 在 **Dashboard/决策层** 看来，我们的系统是**“透明”**的（数据实时刷新）。

这种**“对敌对势力黑盒，对己方业务白盒”**的设计，正是工业互联网系统的核心竞争力所在。我们没有为了安全牺牲业务的实时性，也没有为了方便牺牲数据的安全性。

---

## 📅 下一步计划 (Roadmap to v1.0)

v0.X 系列的迭代至此已全部完成（MVP -> Edge -> Business -> Security）。
接下来，我们将整合所有模块，向 **v1.0 Release Candidate** 发起冲刺。

* **Redis 缓存**: (已废弃 - 架构做减法，MySQL 直连足够)
* **WebSocket**: 告别“手动刷新”和“轮询”，实现真正的毫秒级实时推送。
* **UI 优化**: 给看板加上更有科技感的主题。